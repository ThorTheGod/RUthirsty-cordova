<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>è°ƒè¯• - å–æ°´è®°å½•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .section {
            background: #2d2d2d;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #3e3e3e;
        }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #1177bb;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .warning { color: #dcdcaa; }
    </style>
</head>
<body>
    <h1>ğŸ” å–æ°´è®°å½•è°ƒè¯•å·¥å…·</h1>
    
    <div class="section">
        <h2>ğŸ“Š å½“å‰çŠ¶æ€</h2>
        <button onclick="checkStatus()">æ£€æŸ¥çŠ¶æ€</button>
        <button onclick="viewRecords()">æŸ¥çœ‹è®°å½•</button>
        <button onclick="clearStorage()">æ¸…ç©ºå­˜å‚¨</button>
        <button onclick="addTestRecord()">æ·»åŠ æµ‹è¯•è®°å½•</button>
        <pre id="status">ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹çŠ¶æ€...</pre>
    </div>

    <div class="section">
        <h2>ğŸ’¾ LocalStorage å†…å®¹</h2>
        <button onclick="viewStorage()">æŸ¥çœ‹å­˜å‚¨</button>
        <pre id="storage">ç‚¹å‡»æŒ‰é’®æŸ¥çœ‹...</pre>
    </div>

    <div class="section">
        <h2>ğŸ§ª æµ‹è¯•æ“ä½œ</h2>
        <button onclick="testSave()">æµ‹è¯•ä¿å­˜</button>
        <button onclick="testLoad()">æµ‹è¯•åŠ è½½</button>
        <button onclick="fixRecords()">ä¿®å¤è®°å½•æ ¼å¼</button>
        <pre id="test">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</pre>
    </div>

    <script>
        const STORAGE_KEY = 'drinkWaterRecords';

        function checkStatus() {
            const output = document.getElementById('status');
            let result = '<span class="success">âœ“ æ£€æŸ¥ç»“æœ:</span>\n\n';
            
            // æ£€æŸ¥ localStorage
            const stored = localStorage.getItem(STORAGE_KEY);
            result += `LocalStorage é”®: ${STORAGE_KEY}\n`;
            result += `å­˜å‚¨çŠ¶æ€: ${stored ? '<span class="success">å­˜åœ¨</span>' : '<span class="error">ä¸å­˜åœ¨</span>'}\n`;
            
            if (stored) {
                try {
                    const records = JSON.parse(stored);
                    result += `è®°å½•æ•°é‡: <span class="success">${records.length}</span>\n`;
                    result += `æ•°æ®ç±»å‹: ${Array.isArray(records) ? '<span class="success">æ•°ç»„</span>' : '<span class="error">éæ•°ç»„</span>'}\n`;
                    
                    if (records.length > 0) {
                        result += `\næœ€æ–°è®°å½•:\n`;
                        const latest = records[0];
                        result += `  ID: ${latest.id}\n`;
                        result += `  æ—¶é—´: ${latest.time}\n`;
                        result += `  æ—¥æœŸ: ${latest.date}\n`;
                    }
                } catch (e) {
                    result += `<span class="error">è§£æé”™è¯¯: ${e.message}</span>\n`;
                }
            }
            
            output.innerHTML = result;
        }

        function viewRecords() {
            const output = document.getElementById('status');
            const stored = localStorage.getItem(STORAGE_KEY);
            
            if (!stored) {
                output.innerHTML = '<span class="warning">âš  æ²¡æœ‰æ‰¾åˆ°è®°å½•</span>';
                return;
            }
            
            try {
                const records = JSON.parse(stored);
                let result = `<span class="success">âœ“ æ‰¾åˆ° ${records.length} æ¡è®°å½•:</span>\n\n`;
                
                records.forEach((record, index) => {
                    result += `${index + 1}. ${record.date} ${record.time} (ID: ${record.id})\n`;
                });
                
                output.innerHTML = result;
            } catch (e) {
                output.innerHTML = `<span class="error">âœ— è§£æå¤±è´¥: ${e.message}</span>`;
            }
        }

        function viewStorage() {
            const output = document.getElementById('storage');
            const stored = localStorage.getItem(STORAGE_KEY);
            
            if (!stored) {
                output.innerHTML = '<span class="warning">âš  LocalStorage ä¸ºç©º</span>';
                return;
            }
            
            output.textContent = stored;
        }

        function clearStorage() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿ')) {
                localStorage.removeItem(STORAGE_KEY);
                document.getElementById('status').innerHTML = '<span class="success">âœ“ å­˜å‚¨å·²æ¸…ç©º</span>';
            }
        }

        function addTestRecord() {
            const stored = localStorage.getItem(STORAGE_KEY);
            let records = stored ? JSON.parse(stored) : [];
            
            const now = new Date();
            const record = {
                id: Date.now(),
                timestamp: now.getTime(),
                date: formatDate(now),
                time: formatTime(now)
            };
            
            records.unshift(record);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
            
            document.getElementById('status').innerHTML = 
                `<span class="success">âœ“ å·²æ·»åŠ æµ‹è¯•è®°å½•</span>\n\n` +
                `ID: ${record.id}\n` +
                `æ—¶é—´: ${record.time}\n` +
                `æ—¥æœŸ: ${record.date}\n` +
                `æ€»è®°å½•æ•°: ${records.length}`;
        }

        function testSave() {
            const output = document.getElementById('test');
            try {
                const testData = [
                    {
                        id: Date.now(),
                        timestamp: Date.now(),
                        date: formatDate(new Date()),
                        time: formatTime(new Date())
                    }
                ];
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(testData));
                output.innerHTML = '<span class="success">âœ“ ä¿å­˜æµ‹è¯•æˆåŠŸ</span>';
            } catch (e) {
                output.innerHTML = `<span class="error">âœ— ä¿å­˜å¤±è´¥: ${e.message}</span>`;
            }
        }

        function testLoad() {
            const output = document.getElementById('test');
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (!stored) {
                    output.innerHTML = '<span class="warning">âš  æ²¡æœ‰æ•°æ®</span>';
                    return;
                }
                
                const records = JSON.parse(stored);
                output.innerHTML = 
                    `<span class="success">âœ“ åŠ è½½æˆåŠŸ</span>\n\n` +
                    `è®°å½•æ•°: ${records.length}\n` +
                    `æ•°æ®: ${JSON.stringify(records, null, 2)}`;
            } catch (e) {
                output.innerHTML = `<span class="error">âœ— åŠ è½½å¤±è´¥: ${e.message}</span>`;
            }
        }

        function fixRecords() {
            const output = document.getElementById('test');
            const stored = localStorage.getItem(STORAGE_KEY);
            
            if (!stored) {
                output.innerHTML = '<span class="warning">âš  æ²¡æœ‰æ•°æ®éœ€è¦ä¿®å¤</span>';
                return;
            }
            
            try {
                let records = JSON.parse(stored);
                
                // ç¡®ä¿æ˜¯æ•°ç»„
                if (!Array.isArray(records)) {
                    records = [];
                }
                
                // ä¿®å¤æ¯æ¡è®°å½•
                records = records.map(record => {
                    if (!record.id) record.id = Date.now() + Math.random();
                    if (!record.timestamp) record.timestamp = Date.now();
                    if (!record.date) record.date = formatDate(new Date(record.timestamp));
                    if (!record.time) record.time = formatTime(new Date(record.timestamp));
                    return record;
                });
                
                localStorage.setItem(STORAGE_KEY, JSON.stringify(records));
                output.innerHTML = 
                    `<span class="success">âœ“ ä¿®å¤å®Œæˆ</span>\n\n` +
                    `ä¿®å¤äº† ${records.length} æ¡è®°å½•`;
            } catch (e) {
                output.innerHTML = `<span class="error">âœ— ä¿®å¤å¤±è´¥: ${e.message}</span>`;
            }
        }

        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');
            return `${hours}:${minutes}:${seconds}`;
        }

        // è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.onload = () => {
            checkStatus();
        };
    </script>
</body>
</html>
